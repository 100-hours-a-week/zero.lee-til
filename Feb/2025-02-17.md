# TIL Template

## 날짜: 2025-02-17

### 스크럼
- 학습 목표 1 : k8s 개념 강의
- 학습 목표 2
- 학습 목표 3

### 새로 배운 내용
#### 주제 1: 쿠버네티스 파드
파드(Pod)는 쿠버네티스에서 가장 작은 배포 단위로, **컨테이너를 실행하는 기본 단위**

파드의 주요 특징

- 같은 네트워크 네임스페이스 공유 → 파드 내부의 컨테이너들은 같은 IP 주소와 포트 범위를 공유한다.
- 같은 스토리지 볼륨 공유 → 파드 안의 컨테이너끼리는 파일 시스템을 공유할 수 있어!
- 같은 Node에서 실행됨 → 파드 내부 컨테이너들은 항상 같은 노드(Node)에서 실행된다.
- 일시적인 존재 → 특정 컨테이너가 종료되거나 삭제되면, 파드도 사라질 수 있다.

### **파드의 네트워크 특징**

파드는 기본적으로 **자체적인 IP 주소**를 가지지만, 몇 가지 특성을 알아두면 좋아.

📌 **파드 네트워크의 특징**
1️⃣ **파드마다 고유한 IP 주소**를 가짐 → 같은 노드에 있는 다른 파드와도 네트워크 통신 가능!

2️⃣ **하지만 DHCP가 아니라 쿠버네티스가 직접 IP를 할당** → 따라서 파드가 재시작되면 IP가 변경될 수 있음.

3️⃣ **파드 간 통신을 위해 Service를 사용** → 특정 파드를 계속 접속하려면 "서비스(Service)"를 만들어야 함.

- 서비스
    - k8s에서 파드와 클라이언트를 연결하는 역할
    - 파드가 클라이언트의 요청을 받을 수 있도록 대표 IP를 취득 , 내부 DNS에 등록
    - 대표IP로 요청 트래픽에 대한 부하분산하여 전송하는 역할
- 스토리지
    - 중요 데이터 보관
    - 퍼시스턴트 볼륨을 사용해 전원이 꺼져도 데이터가 유지되는 스토리지에 저장
    - 퍼시스턴트 볼륨은 k8s에 포함되지 않기 때문에 외부 스토리지를 이용해야 함
- 기본
    - 하나의 목적을 위해 만들어진 컨테이너를 부품처럼 조합할 수 있도록 설계
    - 파드와 IP 주소와 포트번호를 공유

#### 주제 2: 쿠버네티스 서비스
쿠버네티스에서 **파드(Pod)는 동적인 리소스이다.** 즉, 파드가 생성되었다가 종료되면 IP가 변경될 수 있는데 , 서비스는 **클라이언트 요청을 파드에 전달하기 위한 오브젝트로서 부하 분산 역할을 한다.**

### **기능**

**파드의 동적인 IP 문제 해결**

- 파드는 삭제되었다가 재생성될 수 있음 → **IP가 바뀜**
- 서비스는 파드의 **IP가 바뀌어도 동일한 네트워크 주소(서비스 이름)로 접근할 수 있게 해줌**

**부하 분산(Load Balancing)**

- 클라이언트가 서비스를 호출하면 서비스가 **여러 개의 파드 중 하나를 선택해서 트래픽을 분산**
- 즉, 서비스가 여러 개의 동일한 애플리케이션 인스턴스를 관리하면서 부하를 나눠줌

**내부 DNS를 통해 쉽게 접근 가능**

- 서비스는 생성될 때 **DNS에 등록**됨
- 클라이언트가 `my-service.default.svc.cluster.local` 같은 이름으로 요청하면 자동으로 서비스가 연결된 파드로 요청을 전달

**이름 해결** 

- 서비스는 IP 주소와 서비스명을 k8s 클러스터 내부 DNS에 등록
- k8s 클러스터 내의 파드에서는 서비스 이름으로 접근하는 것이 가능

### **서비스의 동작 방식**

1️⃣ 클라이언트(내부 또는 외부)가 **서비스 이름으로 DNS 요청**

2️⃣ 서비스가 **자신의 클러스터 IP로 요청을 받음**

3️⃣ 서비스는 **Selector(Label) 기반으로 연결된 파드 중 하나를 선택**

4️⃣ 선택된 파드로 트래픽을 전달하여 **응답을 반환**

### **서비스의 종류**

쿠버네티스에서 서비스는 네트워크 범위와 접근 방식에 따라 **4가지 종류**가 있어.

| **서비스 타입** | **설명** |
| --- | --- |
| **ClusterIP** | 기본값, 클러스터 **내부에서만 접근 가능** |
| **NodePort** | 클러스터 외부에서 특정 노드의 포트를 통해 접근 |
| **LoadBalancer** | 클라우드 제공자의 로드밸런서를 사용해 외부 접속 가능 |
| **ExternalName** | 외부 도메인(URL)로 라우팅 |


### Cluster IP

- 쿠버네티스에서 기본적으로 생성되는 서비스 타입이다.
- 클러스터 내부에서만 접근 가능하며, 외부에서는 접근할 수 없다.
- 다른 파드에서 `http://<서비스이름>:<포트>` 형태로 접근 가능하다.

### NodePort

- 클러스터 외부에서 **각 노드의 IP + 특정 포트(NodePort)** 를 통해 접근 가능하다.
- 쿠버네티스는 기본적으로 **30000~32767 범위의 포트**를 할당하여 외부 접근을 허용한다.
- 클러스터 내부의 여러 노드에서 동일한 포트를 통해 서비스가 노출된다.

### LoadBalancer

- 클라우드 환경(AWS, GCP, Azure)에서 **외부 트래픽을 직접 서비스에 전달하기 위한 로드밸런서**를 생성한다.
- 클라우드 제공자가 자동으로 **공인 IP를 할당**하고, 외부에서 접근 가능하다.
- NodePort를 사용하기 때문에  Cluster IP도 자동할당
- 퍼블릭 클라우드 업체에서 제공하는 로드밸런서와도 연동 가능

### ExternalName

- 파드에서 k8s 클러스터로 외부의 엔드 포인트에 접속하기 위한 이름을 해결
- k8s 외부의 DNS 이름을 서비스 이름으로 등록
- 클러스터 내부에서 외부 서비스(예: openAPI)로 트래픽을 전달할 때 사용한다.
- DNS CNAME 레코드를 사용하여 **도메인 주소를 반환**한다.

### 서비스와 파드의 연결

- 서비스가 요청을 전송할 파드를 결정할 때 셀렉터의 라벨과 일치하는 파드를 etcd로부터 선택
- 셀렉터와 디플로이먼트 파드 템플릿의 metadata.label 같은 값을 설정 한다.
- 파드 템플릿으로 만들어지는 경우 같은 속성의 라벨을 부여 받는다.



#### 주제 3: 쿠버네티스 컨트롤러

파드를 제어파드에게 부여할 워크로드의 타입에 따라 적절한 컨트롤러 선택

**FE(워크로드 타입)**

- 요청에 대응하는 처리를 복수의 파드에서 분단하도록 설계
- 24시간 동안 무중단으로 서비스를 제공하며 신기능을 빠르게 배포해야 한다.

**BE(워크로드 타입)**

- 데이터 스토어: 데이터의 보존과 조회 기능
- 캐시: 복수 파드에서 데이터 공유(세션 정보 공유)
- 메시징: 비동기 시스템 간 연계 기능(메시지 브로커 등)
- 마이크로 서비스:  전문적 업무 기능 구현(결제, 배송, 결제 승인 등)
- 배치 처리: 긴 처리 시간을 요하는 업무 기능(ML, 데이터 분석 등)

### **컨트롤러 타입**

- **디플로이먼트**
    - 여러 개의 파드로 수평한 클러스터를 구성될 때 사용
    - 가동 중인 파드를 차례대로 교체하고나 규모를 조절할 수 있는 기능 제어
- **스테이트 풀셋**
    - 파드와 퍼시스턴트 볼륨을 조합하여 데이터 보간에 초점을 둔 컨트롤러
    - 파드와 퍼시스턴트 볼륨에 번호를 매겨 관리
- **잡**
    - 배치 처리를 하는 컨테이너가 정상 종료할 때까지 재실행을 반복하는 컨트롤러
    - 파드의 실행 횟수, 동시 샐행개수, 실행 횟수 상한값을 설정 및 파드 삭제 전 까지 로그를 보존
- **크론잡**
    - 지정한 시간에 정기적으로 잡을 생성
    - crontab과 같은 형식으로 잡의 생성시각을 설정 할 수 있다.
- **데몬셋**
    - k8s클러스터의 모든 노드에서 동일한 파드를 실행하기 위해 존재
    - 네트워크를 구성하는 파드는 데몬셋에 의해 모든 노드에서 실행 (새로운 노드도 포함)
    - 시스템 운영의 자동화에 적합
- **리플리카셋**
    - 디플로이먼트 컨트롤러와 연동해서 파드가 기동되어야 되는 수를 관리
    - 리플리카셋은 직접 설정하기보다 디플로이먼트를 활용하는 것이 기본 설정
- **레플리케이션 컨트롤러**
    - 예전 튜토리얼등에 언급되며 현재 디플로이먼트로 대체됨

### **컨트롤러의 역할**

쿠버네티스에서 컨트롤러는 **사용자가 정의한 상태(Desired State)와 실제 상태(Current State)를 지속적으로 비교**하면서 문제가 발생하면 이를 자동으로 조정

📌 **컨트롤러의 핵심 역할**

✅ **파드나 워크로드의 개수를 자동으로 조정**

✅ **노드 장애 발생 시 자동 복구(Self-healing)**

✅ **스케줄링된 작업 실행 (예: CronJob)**

✅ **퍼시스턴트 볼륨(스토리지) 관리**

### 리플리카셋

- 리플리카셋은 쿠버네티스에서 파드 개수를 유지하는 컨트롤러
- 파드 장애 발생 시 자동 복구(Self-healing) 가능
- 수평 확장(Scaling)과 부하 분산(Load Balancing) 지원
- 웹 서버, API 서버, 트래픽 변화가 큰 서비스에서 필수적으로 사용

### 디플로이먼트

- 디플로이먼트(Deployment)는 쿠버네티스에서 가장 강력한 애플리케이션 배포 도구
- 파드와 리플리카셋을 자동으로 관리하며, 무중단 업데이트(롤링 업데이트) 가능
- 문제가 발생하면 즉시 롤백 가능
- 트래픽 변화에 따라 자동으로 확장 가능 (HPA 사용 가능)
- 운영 환경에서는 디플로이먼트를 기본적으로 사용

### **디플로이먼트의 배포 전략(Deployment Strategies)**

쿠버네티스에서 애플리케이션 버전을 변경할 때 주로 **두 가지 배포 방식**을 사용해.

| 배포 방식 | 설명 | 장점 | 단점 |
| --- | --- | --- | --- |
| **롤링 업데이트 (Rolling Update)** | 기존 파드를 점진적으로 새 버전으로 교체 | 무중단 배포 가능, 안정적 | 배포 속도가 느릴 수 있음 |
| **리크리에이트 (Recreate)** | 기존 파드를 모두 삭제 후 새 버전 배포 | 간단하고 빠름 | 서비스 중단 발생 가능 |

### 쿠버네티스 잡 컨트롤러

- 잡 컨트롤러는 일괄 처리 타입의 워크로드에 적합
- 잡 컨트롤러 관리하에 컨테이너가 비정상 종료하면 상한 값 또는 정상 종료 까지 반복
- 잡 컨트롤러와 메시지 브로커를 조합하면 병렬 처리를 위한 파라미터 전달 가능
- 크론잡은 시간에 맞춰 정기적으로 잡을 실행하는 컨트롤러

### job과 cron job

- job
    - 컨테이너가 정상적으로 종료할때 까지 재실행한다.
    - 지정한 실행 횟수와 병행 개수에 따라 한 개 이상의 파드를 실행
    - Job은 모든 컨테이너가 정상 종료한 경우에만 정상 처리하며 하나라도 비정상이면 전체 비정상
- cronjob: Unix의 크론과 같은 포맷으로 실행 스케줄을 지정할 수 있는 컨트롤러
    - *(분) *(시) *(1개월 중의 일)  *(월) **(요일)  “* * * * * * ”
    - 지정한 시각에 잡을 만듬
    - 파드의 개수가 정해진 수를 넘어서면 가비지 수집 컨트롤러가 종료 된 파드 삭제


**단독(알몸) 파드 구동**

📌 **컨트롤러 없이 실행된 파드 (Standalone Pod)**

✔ 컨테이너가 종료되면 **직접 삭제해야 함**

✔ **자동 복구되지 않음**

✔ **수평 확장(Scaling) 불가능**

✔ 실무에서는 거의 사용하지 않음 → **컨트롤러를 통해 관리하는 게 일반적**

**서버 타입의 파드 제어 (웹 서비스 등)**

📌 **Deployment(디플로이먼트)와 ReplicaSet(레플리카셋)이 관리하는 파드**

✔ **요청을 지속적으로 처리하는 애플리케이션**(예: 웹 서버, API 서버)

✔ **수평 확장(Scaling) 가능** → 필요하면 파드 개수를 자동으로 늘릴 수 있음

✔ 파드가 **비정상 종료되어도 자동으로 복구됨**

✔ `kubectl scale --replicas=5 deployment my-app` → 쉽게 파드 개수 조정 가능

**배치 처리 타입 파드 제어 (일회성 작업)**

📌 **Job(잡)과 CronJob(크론잡)이 관리하는 파드**

✔ **배치 작업(한 번 실행 후 종료) 또는 정기 작업(스케줄링 실행)에 적합**

✔ **처리가 정상적으로 끝나면 자동으로 종료됨**

✔ **실패하면 자동 재시작 가능**

✔ 병렬 실행도 가능 (예: 데이터 처리, 백업 작업)



### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 개념 정리


### 오늘의 회고
- 쿠버네티스를 처음 들어가는 날인데, 기존에 있던 지식이 없다보니 따라가는데 정말 힘들었다. 너무 내용이 방대해서 이게 어떤 기능을 하고 흐름을 이해하는 것 조차 힘들었다.

### 참고 자료 및 링크
- [링크 제목](URL)
- [링크 제목](URL)

# TIL Template

## 날짜: 2025-03-04

### 스크럼
- 학습 목표 1 : 해커톤 회고
- 학습 목표 2
- 학습 목표 3

### 새로 배운 내용
#### 주제 1: S3

## 개요

- 관리형 스토리지 솔루션
- 버킷에 데이터를 객체로 저장
    - 버킷은 하나의 볼륨과 유사
- 단일 객체는 최대 5TB 까지 저장
- 버킷 및 객체에 대한 접근 제어 가능
- 암호화 기능 제공
    - SSE
    - CSE
- HTTP(S)를 통해 인터넷 접근 가능
- VPC를 통해서 AWS 내부망 접근 가능
- 데이터 사용 특성에 맞는 저장 계층 제공

## 버킷과 객체

- 버킷의 이름은 모든 AWS 사용자들에 대해서 유일한 값이어야 한다.
- S3는 글로벌 서비스이기 때문에 버킷명은 리전에 관계 없이 유일
    - 이미 다른 AWS계정에서 사용중인 버킷명은 사용할 수 없다.
    - S3의 특정 객체는 S3 엔드포인트 URL을 이용해 인터넷을 통한 접근이 가능하기 때문
- 버킷명은 3~63자의 문자열로 구성
- 리전 간 복제
- 특정 리전에 저장된 버킷 내에 있는 개개체들을 다른 리전 혹은 같은 리전의 지정된 버킷으로 복제하는 기능
    - 예시 : 특정 리전의 S3 서비스에 문제가 생길 것을 대비하여 다른 리전에 백업 용도로 저장하는 경우
    - 특정 지역의 사용자들이 빠르게 접근할 수 있도록 다른 리전에 저장하는 경우

![image.png](attachment:7fa61568-a306-4094-adb9-9e13c8e349ed:image.png)

## 디렉토리 구조

- S3는 모든 객체가 버킷 하위에 저장되는 플랫 파일 시스템
- 단, 버킷 내에 존재하는 객체의 이름에 /(slash) 문자를 포함하면 디렉토리 구조로 표현됨
- 즉, / 문자는 객체 이름의 일부일 뿐 실제로는 버킷 바로 아래에 모든 객체가 존재함
- 버킷 내의 객체명은 버킷 내에서 유일해야 한다.
    - 버킷명과 객체명
        - seoulef-test1/**A/a.txt (키 , 버킷내 유일)**
        - seoulef-test1/**B/b.txt**

## S3 데이터 전송 비용

- S3에 업로드하는 비용은 무료
- 다운로드는 경우에 따라 유료
    - 유료 ⇒ 인터넷 망을 통해 s3에 다운로드 하는 경우
    - 무료
        - 일정 규모 이하(100GB)까지는 다운로드 무료
        - Ec2 인스턴스에서 AWS 내부 네트워크를 통해 S3의 데이터를 다운로드 하는 경우

## S3 스토리지 클래스

- S3에 저장하려는 파일은 유실을 허용하는 정도에 차이가 있다.
- 저장소의 안정성이 높고 낮음에 따라 **S3 저장 비용에 차등**
- 사용자는 그에 맞춰서 적합한 저장소를 선택하야 함
- 이러한 저장소의 **등급 차이를 스토리지 클래스**라고 함
    - 빈번하게 접근 하는 경우
        - 스탠다드
        - Reduced Redundancy(RRS)
    - 적은 빈도
        - 스탠다드 IA
        - One Zone IA
        - Glacier
    - 빈도를 모니터링해서 자동으로 적절한 스토리지 클래스를 선택하는 기능
        - Intelligent Tiering
- S3 스토리지 클래스 선택 기준
    - **데이터에 대한 접근 빈도**

### 스탠다드 클래스

- 가장 빠른 응답 성능인 밀리초 단위 지연시간 제공
- 가장 높은 지속성과 가용성 제공
- S3데이터는 리전의 특정 가용 영역에 저장이 되는데 , 스탠다드의 경우 3개 이상의 가용영역에 복제본이 저장되어 특정 가용 영역에 문제가 생기더라도 데이터 사용이 가능

### RRS

- 가장 낮은 지속성 제공
- 스탠다드와 동일한 수준의 가용성
- 데이터가 유실되더라도 언제든 재생성 가능한 경우에 사용 권장
- 썸네일 등 원본 데이터를 재처리한 데이터를 저장하기에 적합

### 스탠다드 IA

- 적은 빈도로 접근하는 데이터에 적합한 클래스
- 스탠다드와 동일한 밀리초 단위 지연시간과 지속성 수준 제공
- 스탠다드 대비 낮은 수준의 가용성 제공
- 최소 128kb 사이즈 이상의 파일을 저장하는데 적합
- **재생성이 어려운 데이터 저장에 적합**
- 여러 가용 영역에 데이터 복제 저장

### One Zone IA

- 하나의 개용 영역에서만 데이터가 저장
- 해당 가용 영역 문제 발생 시 데이터 접근 불가
- 99.5%의 가용성 제공

### Glacier

- 데이터를 자주 사용하지 않지만 장기 보관해야하는 경우 (archiving)
- 빈번하지 않지만 접근과 장기 보관인 archiving을 위해 만들어진 클래스
- 이동하는데 걸리는 시간은 옵션에 따라 달라지며 ,1분에서 12시간까지 다양하게 설정
    - SSD,HDD, 테이프 드라이브
- 아카이브를 저장하고 관리할 수 있는 공간을 **볼트**라고 함
- 볼트의 이름은 리전 내에서 유일
- Glacier에서 데이터 가져오기
    - 데이터 검색 및 다운로드 가능한 상태로 만들기
    - 데이터 다운로드

![image.png](attachment:fc23c64d-b5c6-49cb-bbd5-e4140ee1ae91:image.png)

## S3의 지속성

- 갑작스런 데이터 유실과 손상을 방지할 수 있는 정도

## S3의 가용성

- 특정 데이터에 접근 시 정상적으로 해당 데이터를 사용할 수 있을 확률
- (정상 상태 시간 - 시스템 비정상 상태의 시간)/24시간

## S3의 전체 비용

- S3 전송 비용
- S3에 업로드한 데이터 크기
- 사용중인 S3 스토리지 크기

## 접근 권한

- S3는 인터넷망을 통해 접근 가능한 서비스 엔드포인트 URL이 제공
- 단, 누구나 접근하게 되면 보안 문제 발생 가능

### 1. 버킷 저책 - 리소스 기반정책

- 버킷의 속성에 접근이 가능한 주체를 지정하고, 버킷 내 객체에 대한 읽기/쓰기 연산 허용 결정
- 버킷 내 객체별로 서로 다른 정책 설정 가능, 주체 별로 서로 다른 권한을 갖도록 설정이 가능

### 2. 사용자 정책- 신원 기반 정책

- IAM 사용자에게 할당한 권한에 버킷과 객체에 대한 권한 명시

### 3. 버킷 및 객체 접근 제어 리스트

- 다른 AWS 계정에 해당 버킷에 대한 접근 권한을 부여하는 방법
- 다른 AWS 계정 사용자가 내 AWS 계정의 S3 버킷에 데이터를 업로드할 때 필요

## 암호화

- S3에 저장되는 데이터는 사용자가 업로드 하는 그대로 저장됨
- 중요한 정보를 업로드 한다면 암호화 기능을 활성화해서 업로드를 수행
- 암호화가 활성화되면 S3에 업로드한 데이터가 저장되기 전에 S3 서비스 내부에서 데이터를 암호화해서 저장하는데, 이를 유휴 시 암호화라고 함

### 1. 서버 측 암호화

- 사용자가 데이터를 업로드
- S3 서비스에서 해당 파일을 암호화
- 버킷에 저장

### 2. 클라이언트 측 암호화

- 사용자가 데이터를 업로드 하기 전에 미리 암호화 수행
- 암호화 키에 대한 관리 책임은 사용자에 있다.

## 버전관리

- s3의 데이터가 덮어써지거나, 삭제 되는 것을 방지하기 위해 버전 관리 기능 사용
- 활성화 시 , 객체가 변경되거나 삭제될 때 이전의 상태를 넘버를 할당해서 보관
- 버전관리는 버킷 단위로 활성화할 수 있으며, 활성화 이후 변경사항 발생 건에 대해서 버전 생성
- 기본적으로 버전은 무한히 생성될 수 있으며, 수동으로 삭제하거나 객체 생명 주기 설정을 통해 조절 가능

## 객체 생명 주기 설정

- S3에 제한 없이 데이터를 업로드 할 수 있기 때문에 로그와 같이 지속적으로 자동생성되는 데이터를 S3에 업로드 하도록 시스템을 구성한 경우, 관리 소홀로 인한 과도한 요금 발생 가능
- 이 경우 S3는 빈번하게 사용되지 않는 객체들은 비용이 저렴한 스토리지 클래스로 이동시키거나, 불필요한 경우 삭제하는 객체 생명 주기 설정 기능이 제공

### 1. 전환 작업

- 객체 생성 후 , 다른 스토리지 클래스로 전환되는 시기를 정의하면 자동으로 해당 클래스로 이동하는 작업

### 2. 만료 작업

- 객체가 생성 후 , 지정된 시간 후에 자동으로 객체를 삭제하는 작업

#### 주제 2: 3Tier 아키텍쳐
# VPC

![image.png](attachment:a325ae5c-7bfb-4c19-a1e7-adfc0c28c93d:image.png)

## 1. VPC 생성

1. 이름 / 태그 VPC-zero0304
2. IPv4 CIDR `192.168.0.0/16`

## 2. 서브넷 생성

### **Azone**

- `subnet-public-A` / 가용영역 : (VPC 동일 리전 -A) / CIDR: 192.168.10.0/24
- `subnet-nat-private-A` / 가용영역 : (VPC 동일 리전 -A) / CIDR: 192.168.110.0/24
- `subnet-private-A` / 가용영역 : (VPC 동일 리전 -A) / CIDR: 192.168.210.0/24

### **Czone**

- `subnet-public-C` / 가용영역 : (VPC 동일 리전 -C) / CIDR: 192.168.w0.0/24
- `subnet-nat-private-C` / 가용영역 : (VPC 동일 리전 -C) / CIDR: 192.168.120.0/24
- `subnet-private-C` / 가용영역 : (VPC 동일 리전 -C) / CIDR: 192.168.220.0/24

### 라우팅 테이블 생성

- 기존 defaut → `RT-PUBLIC-ZERO0304`  (VPC 확인할 것)
- 생성 → `RT-PRIVATE-ZERO0304`
- 생성 → `RT-NAT-PRIVATE-ZERO0304-A`
- 생성 → `RT-NAT-PRIVATE-ZERO0304-C`

## 3. 인터넷 게이트웨이 생성

vpc에 연결 → 새로 생성한 VPC에 연결

## 4. NAT 게이트 웨이 생성

`NAT-ZERO0304-A` / 서브넷 : `subnet-public-A`  / 탄력적 IP 할당

`NAT-ZERO0304-C` / 서브넷 : `subnet-public-C`  / 탄력적 IP 할당

## 5. 라우팅

### `RT-PUBLIC`

1. 생성한 `RT-PUBLIC-ZERO0304` 테이블 체크
2. 라우팅 편집 → 0.0.0.0/0 → 인터넷 게이트웨이  
3. 서브넷 연결 (편집) → public 서브넷 A/C 연결 ( `subnet-public-A`, `subnet-public-C)`

### `RT-NAT-PRIVATE-A/C`

1. 생성한 `RT-NAT-PRIVATE-ZERO0304-A` , `RT-NAT-PRIVATE-ZERO0304-C` 테이블 체크
2. 라우팅 편집 → 0.0.0.0/0 → NAT 게이트웨이 -A/C  `NAT-ZERO0304-A` , `NAT-ZERO0304-C`
3. 서브넷 연결(편집) →  `subnet-nat-private-A` , `subnet-nat-private-C`

### `RT-PRIVATE`

1. 생성한 `RT-PRIVATE-ZERO0304` 테이블 체크
2. 서브넷 연결 (편집) → private 서브넷 A/C 연결 (`subnet-private-A`, `subnet-private-C)`

![image.png](attachment:16c001c8-1612-485b-b46b-58fd09c888bd:image.png)

# OPENVPN

### EC2 생성

- `EC2-RIVE-OEPNVPN`
- 더 많은 AMI 찾아보기
    - openVPN Access Server 구독
- 키페어
- 인스턴스 유형 `t2.small`이상
- 네트워크 설정 : `subnet-public-A`

### 실행

admin 사이트로 접속 후 다운로드

![image.png](attachment:d0aa987a-a20a-4f9b-b387-6523ee888219:image.png)

## **OpenVPN이 필요한 이유**

1. **Private Subnet의 리소스 접근**
    - Nginx, RDS 등은 Private Subnet에 위치하여 외부에서 직접 접근할 수 없음
    - OpenVPN을 통해 내부 네트워크에 안전하게 연결 가능

## **API 요청 시 네트워크 흐름**

### **클라이언트 → API 요청 → DB 조회까지의 흐름**

1️⃣ **클라이언트(API 요청)**

- 사용자가 웹 또는 모바일 클라이언트에서 API를 호출 (예: `https://api.example.com/getUser`)
- 이 요청은 인터넷을 통해 **EC2 Nginx 서버**로 전달됨

2️⃣ **Nginx(Web 서버)에서 요청 처리**

- Public Subnet이 없으므로, 클라이언트는 **OpenVPN을 통해 내부 네트워크에 접근**
- OpenVPN을 통해 EC2 Nginx 서버(Private Subnet)로 요청 전달

3️⃣ **애플리케이션 서버에서 비즈니스 로직 수행**

- Nginx는 단순 정적 웹 서버 역할 또는 API Gateway 역할을 수행
- API 요청을 분석하고, 필요하면 백엔드 애플리케이션 또는 데이터베이스로 요청 전달

4️⃣ **Amazon RDS(Database)에서 데이터 조회 및 반환**

- EC2 Nginx 서버가 DB 조회 요청을 Amazon RDS로 전달
- RDS는 데이터를 조회하고 Nginx 서버로 응답 반환

5️⃣ **클라이언트에게 응답 반환**

- Nginx는 RDS에서 받은 데이터를 JSON 또는 HTML 형태로 변환
- 클라이언트는 API 응답을 받아 화면에 표시

# COMPUTE

### 1. EC2 생성

- `EC2-zero0304-a`
- 네트워크 설정
    - VPC, 서브넷 설정 `subnet-nat-private-A`
    - 보안그룹
        - 22,80 0.0.0.0/0 허용

### 2. 대상 그룹 설정

- 인스턴스
- `TG-web-zero0304`
- VPC
- EC2 compute `EC2-zero0304-a` 연결

### 3. 로드밸런서 생성

- Application Load -Balancer 생성
- 네트워크 매핑
    - VPC
    - 서브넷 (`subnet-public-A` , `subnet-public-C)`
- 보안그룹 설정
- 리스너 및 라우팅
    - HTTP : 80
    - `TG-web-zero0304`

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 3tier 실습
- 도전 과제 2: 관련서적 읽기

### 오늘의 회고
- 오랜만에 수업을 들어서 집중력을 유지하는데 신경을 많이 썼다. AWS 실습을 진행하면서 나오는 billing에 더 신경 써야 할 것 같다.

### 참고 자료 및 링크
- [링크 제목](URL)
- [링크 제목](URL)

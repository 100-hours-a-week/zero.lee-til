# TIL Template

## 날짜: 2025-03-05

### 스크럼
- 학습 목표 1 : 
- 학습 목표 2
- 학습 목표 3

### 새로 배운 내용 : AWS 보안
#### 주제 1: IAM 권한
AWS 계정을 사용하는 IAM 사용자가 지정된 AWS 서비스에 대해서 리소스를 생성하거나 제어할 수 있도록하는 기능

### 권한을 갖는 대상

- IAM 사용자, 그룹 또는 역할 → Identity based Policy
    - 정책에 정의한 내용을 바탕으로 AWS 서비스와 생성된 리소스에 접근할 수 있는 권한을 갖게 됨
- AWS 리소스 → Resource based Policy
    - AWS S3와 Bucket과 같은 리소스에 직접 정책을 설정하고, 해당 정책에 따라 접근 가능한 대상을 지정할 수 있다.
    - 특정 서비스에 대해서 사용 가능(AWS, S3, SWS EFS등)
- IAM 엔티티에 대해 권한을 부여
    - IAM 사용자, 역할 그리고 그룹을 의미
    - 다음과 같은 경우 사용됨
        - IAM 사용자 1은 EC2 서비스에 대한 모든 기능을 사용할 권한을 갖는다. (Full Access)
        - IAM 그룹 2에 속한 IAM 사용자들은 이 계정의 모든 서비스에 대한 사용 권한을 갖는다.
        - IAM 역할 3은 S3의 abc 버킷에 대한 읽기/쓰기 권한을 가진다.
- AWS 서비스에서 생성한 리소스에 권한을 부여
    - S3 버킷과 같은 특정 리소스에 대해서 지정 가능
        - S3의 A 버킷을 IAM 사용자 1이 읽기/쓰기 연산을 수행 가능하다.
        - SQS의 queue2는 IAM 사용자 2가 모든 권한을 갖고 접근할 수 있다.

## 정책 평가 방법

### 자격 증명 및 리소스 기반 정책 평가 방법

- 최종권한
    - 자격증명 기반 정책에서 허용하는 권한
    - 리소스 기반 정책에서 허용하는 권한
    - 단 , 둘 중 하나라도 **명시적 거부**가 있을 경우에는 접근 불가

### 권한 경계와 정책 평가 방법

- 최종 권한
    - 자격증명 기반 정책에서 허용하면서, 권한 경계 정책에서도 허용하는 권한
    - 둘 중 하나라도 **명시적 거부**가 있으면 접근 불가

### 권한 경계, 리소스 및 자격증명 기반 정책 평가 방법

- 최종 권한
    - 자격 증명 기반 정책에서 허용 하면서, 권한 경계 정책에서도 허용하는 권한
    - 리소스 기반 정책에서 허용하는 권한
    - 셋 중 하나라도 **명시적 거부**가 있으면 접근 불가

#### 주제 2: Public subnet vs Private subnet
## Elastic Network Interface

### **NIC**

- 컴퓨터 네트워크 연결을 위해서는 네트워크 인터페이스 카드가 필요
- NIC에 IP를 할당하고, 이를 통해 컴퓨터 간에 실제 통신이 이루어짐
- NIC를 여러 개 설치하면 , 여러 개의 IP를 가질 수 있어 하나의 기기에서 여러 네트워크 에 접속이 가능
- AWS에서는 ENI를 통해 EC2 인스턴스에 네트워크 카드를 가상으로 연결
- EC2 인스턴스 생성 시, 기본 ENI가 생성되어 연결(해제 불가)
- 서브넷의 IP 대역 중 하나가 EC2 인스턴스의 ENI에 할당되면서 네트워크에 연결
- 공인 IP역시 ENI에 연결되며, 사설 IP와 공인 IP가 쌍으로 연결
    - 공인 IP는 EIP일 수도 있고 , VPC에서 자동 할당 되는 공인 IP일 수도 있음

### DHCP

- 네트워크에 연결된 장치에 IP를 자동으로 부여하는 서비스
- VPC 생성 시 기본적으로 DHCP 서비스가 동작하여, VPC 내의 서버에 자동으로 IP 할당
- VPC 내에 서브넷의 IP CIDR Block에 맞게 IP가 할당됨

## Public Subnet vs Private Subnet

- 퍼블릿 서브넷과 프라이빗 서브넷

### 퍼블릿 서브넷

- 라우팅 테이블을 통해 인터넷 게이트웨이와 연결된 서브넷

### 프라이빗 서브넷

- 라우팅 테이블을 통해 인터넷 게이트웨이와 연결되지 않은 서브넷
- 인터넷을 통해 외부에서 접근이 불가능한 서브넷

### 퍼블릿/프라이빗 서브넷 생성 방법

- 라우팅 테이블을 서로 다르게 생성 →  특정 서브넷의 라우팅 테이블에만 인터넷 게이트웨이 연결
- 라우팅 테이블은 기본적으로 VPC 내의 subnet간에는 통신이 가능하도록 설정

![image.png](attachment:b0ae3060-7837-4f6e-87c8-d9ae2111a11c:image.png)

- 퍼블릿 서브넷과 프라이빗 서브넷을 같은 가용영역의 쌍으로 설정한 이유
    - AWS에서 가용영역은 데이터 센터를 의미
    - 가용영역간에 통신은 데이터 전송량에 따라 비용이 발생
    - 같은 가용영역이면 서브넷이 달라도 비용이 발생하지 않음

### 공인 IP

- 인터넷에 연결하기 위해서 장치들은 인터넷으로 연결되는 경로와 인터넷에서 사용할 공인 IP가 반드시 있어야 한다.
- 인터넷 게이트웨이와 라우팅 테이블을 통해 인터넷 연결 경로 생성

- 가정에서의 공유기를 통한 인터넷 연결
    - ISP에서 공유기에 공인 IP를 할당
    - 공유기에 연결된 기기는 공인 IP를 받지 않는데 어떻게 인터넷을 사용할 수 있는가 → NAT

![image.png](attachment:0977f3e8-efef-44db-a7b0-6fd6fac5e988:image.png)

### NAT

공유기에서 내부에 연결된 장치들이 인터넷으로 접근할 때 , 공유기에 할당된 공인 IP를 이용하도록 지원

- 공유기에서 Nat Table을 활용해 공유기의 공인 IP를 통해서 통신할 수 있도록 지원
- 요청에 대한 응답이 올바른 장치로 전달될 수 있도록 지원
- 즉, 하나의 공인 IP로 여러 장치가 인터넷 사용이 가능해짐
- 단 공인 IP는 공유기에만 할당되어 있으므로, 특정할 수 있는 장치는 공유기 뿐이다.

### NAT를 이용한 프라이빗 서브넷에서의 인터넷 접근

- 프라이빗 서브넷에서 인터넷 접근 가능
- 인터넷 → NAT를 통해 내부로 접근 불가능

![image.png](attachment:39449b8c-a2d6-4289-bd29-e47533219e2b:image.png)

### IP와 Port

- IP는 네트워크에 연결된 대상을 특정할 수 있다.
- 포트는 하나의 컴퓨터에 대해서 네트워크를 사용하는 어플리케이션이 여러 개일 경우 이들을 구분하기 위한 ID 역할을 수행
- 포트는 하나의 컴퓨터 내에서 유일하게 어플리케이션을 구분 (0~65535 까지 사용 가능)
    - 0~1024 well known Port
    - 30000~  Random Access Port
#### 주제 3: 네트워크 접근제어 
- 특정 인스턴스에 접근할 수 있는 네트워크 대역을 한정하여, 공격의 위험성을 제거
- 접근하는 대상을 제한하지 않으면 전세계 어디서든 공인 IP를 보유한 EC2 인스턴스에 접근 가능

## 보안 그룹

Ec2인스턴스에 접근 가능한 네트워크 영역을 제한

- 아웃바운드/인바운드 규칙을 통해 들어오고 나가는 트래픽을 제어 → 방화벽 역할
    - 트래픽 : 네트워크를 통해 교환되는 패킷의 흐름
    - 패킷: 네트워크를 통해 장치간에 교환되는 데이터
- 인바운드 규칙 : 다른 장치에서 ec2 인스턴스로 들어오는 패킷을 제어
- 아웃바운드 규칙: ec2 인스턴스에서 다른 장치로 나가는 패킷을 제어

### 보안그룹 설정

- 아웃 바운드와 인바운드에 **아무런 규칙이 없으면** **어떤 트래픽도 허용 x**
- 외부 네트워크 대역은 인터넷이나 혹은 또 다른 네트워크일 수 있다.
- EC2 인스턴스에서 아웃바운드 허용된 곳으로 보낸 요청에 대한 응답은 **인바운드 규칙과 상관 없이 허용**
- 단 , 외부에서 시작된 요청은 인바운드 규칙에 의해 통제

## NACL

특정 서브넷에 위치한 모든 EC2 인스턴스에 대해 접근 가능한 네트워크 영역을 제한

- 아웃바운드/인바운드 규칙을 통해 서브넷 내부로 들어오고 내부에서 나가는 트래픽을 제어
- vpc를 생성하면 기본 NACL이 생성되어 있으며, 모든 서브넷이 해당 NACL을 사용하도록 설정
- NACL 규칙은 대상으로 나가고 원천에서 들어오는 트래픽에 대한 **허용과 거부**로 구성
- NACL 생성 시 기본으로 인/아웃 모두 0.0.0.0/0에 대한 거부가 설정되어 있으며 제거 불가
- 허용과 거부가 동시에 있을 경우 **낮은 규칙번호가 우선순위가 높다.**

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 3Tier Architecture 실습
- 도전 과제 2: 코딩 테스트 공부

### 오늘의 회고
- 실습만 있는 날이라 그런지 집중하는게 좀 힘들었다. AWS실습을 진행하는데 과금이 저번에 많이 나와서 조금 조심스러워졌다.

### 참고 자료 및 링크
- [링크 제목](URL)
- [링크 제목](URL)
